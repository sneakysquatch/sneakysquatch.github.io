function KongregateAPI(){this._initialize()}var Kongregate=Kongregate||{};Kongregate.Utils=Kongregate.Utils||{},Kongregate.Utils.isKlient=function(){return/klient|kartridge\//.test(navigator.userAgent.toLowerCase())},Kongregate.Utils.findKongregateWindow=function(){if(!Kongregate.Utils.isKlient())return top;for(var e=window,t=window.parent;t!==top;)t=(e=t).parent;return e},Kongregate.Utils.catchErrors=function(e,t,n){var s=function(){try{return e.apply(t,arguments)}catch(e){return Kongregate.Log.error("catchErrors caught unhandled exception",e),n}};return s},function(){function e(e,t,n){Kongregate.Log[e]=function(){try{"undefined"!=typeof active_user&&void 0===Kongregate.Log.debugLevel&&(Kongregate.Log.debugLevel=active_user.debugLevel()),(0===t||Kongregate.Log.debugLevel>=t)&&(console[n]?Function.prototype.apply.call(console[n],console,arguments):console.log(arguments))}catch(e){}}}Kongregate.Log={},e("spam",5,"log"),e("debug",4,"log"),e("info",3,"info"),e("warn",2,"warn"),e("error",1,"error"),e("always",0,"log")}(),KonduitEvent={INIT:"init",CONNECT:"connect",CONNECTED:"connected",DISCONNECT:"disconnect",LOGIN:"login",SWITCH_USER:"switch_user",JOIN_ROOM:"join_room",LEAVE_ROOM:"leave_room",USER_JOIN:"user_join",USER_DEPARTURE:"user_departure",USER_CHANGED:"user_changed",ROOM_MESSAGE:"room_message",SYSTEM_MESSAGE:"system_message",PRIVATE_MESSAGE:"private_message",ADMIN_MESSAGE:"admin_message",MESSAGE_ERROR:"message_error",SET_PRESENCE:"set_presence",GUEST_COUNT:"guest_count",ROOM_NOT_FOUND:"room_not_found",ROOM_FULL:"room_full",REQUEST_CHAT_ROOM:"request_chat_room",CREATE_PRIVATE_ROOM:"create_private_room",DESTROY_PRIVATE_ROOM:"destroy_private_room",PRIVATE_ROOM_INVITATION:"private_room_invitation",PRIVATE_ROOM_KICK:"private_room_kick",PRIVATE_ROOM_INVITATION_SENT:"private_room_invitation_sent",JOIN_GUILD_ROOM:"join_guild_room",SILENCED:"silenced",PARTICIPATE:"participate",AMNESTY:"amnesty",API_INITIALIZED:"api_initialized",ADD_STATISTICS:"add_statistics",STATISTIC_UPDATED:"statistic_updated",STATISTIC_SUBMISSION:"statistic_submission",STATISTICS_FLUSH:"statistics_flush",STATISTICS_FORCE_FLUSH:"statistics_force_flush",SET_ACCOMPLISHMENT_PROGRESS:"set_accomplishment_progress",NEW_HIGH_SCORE:"new_high_score",DISPLAY_SHOUT_BOX:"display_shout_box",DISPLAY_INVITATION_BOX:"display_invitation_box",SEND_PRIVATE_MESSAGE:"send_private_message",DISPLAY_FEED_POST_BOX:"display_feed_post_box",DISPLAY_SIGN_IN_LIGHTBOX:"display_sign_in_lightbox",DISPLAY_REGISTRATION_LIGHTBOX:"display_registration_lightbox",LIGHTBOX_OPENED:"lightbox_opened",LIGHTBOX_CLOSED:"lightbox_closed",ACCOMPLISHMENT_TASK_PROGRESS:"accomplishment_task_progress",ACCOMPLISHMENT_COMPLETE:"accomplishment_complete",RESIZE_GAME:"resize_game",HANDLE_ITEM_CHECKOUT_REQUEST:"handle_item_checkout_request",KONDUIT_MESSAGE:"konduit_message",ANALYTICS_PAYLOAD:"analytics_payload",OP_EXTERNAL_MESSAGE:"ext.msg",OP_CONNECTED:"connected",OP_HELLO:"hello",OP_USER_INFO:"user.info",OP_SIGN_IN:"sign_in",PARAM_USER:"user",PARAM_USER_ID:"user_id",PARAM_GAME_AUTH_TOKEN:"auth_token",PURCHASE_RESULT:"purchase_result",PARAM_LOCALCONNECTION_ONLY:"localconnection_only",CUSTOM_TAB_MESSAGE:"custom_tab_message",CUSTOM_TAB_SHOW:"custom_tab_show",CUSTOM_TAB_CLOSE:"custom_tab_close",CUSTOM_TAB_SHOWN:"custom_tab_shown",CUSTOM_TAB_CLEAR_MESSAGES:"custom_tab_clear_messages",OP_CHAT_TAB:"chat.tab",OP_CHAT_CLEAR_DIALOG:"chat.dlg.clear",OP_CHAT_DISPLAY:"chat.disp",OP_CHAT_MSG:"chat.msg",OP_CHAT_CANVAS_ELEMENT:"chat.elm",OP_CHAT_PRIVATE_MESSAGE:"chat.privateMessage",OP_CHAT_RESIZE_GAME:"chat.resizeGame",OP_CHAT_DISPLAY_INVITATION_BOX:"chat.invite",OP_CHAT_DISPLAY_FEED_POST_BOX:"chat.feedpost",OP_CHAT_DISPLAY_REGISTRATION:"chat.registration",OP_CHAT_DISPLAY_SHOUT_BOX:"chat.shoutbox",PARAM_SHOUT_MESSAGE:"shout_message",PARAM_CANVAS_SIZE:"chat.canvas.size",PARAM_RESIZE_GAME_WIDTH:"chat.resizeGame.width",PARAM_RESIZE_GAME_HEIGHT:"chat.resizeGame.height",PARAM_INVITATION_MESSAGE:"invitation_message",PARAM_FRIEND_FILTER:"filter",PARAM_IMAGE_URI:"image_uri",PARAM_KV_PARAMS:"kv_params",PARAM_NAME:"name",PARAM_DESCRIPTION:"desc",PARAM_DATA:"data",OP_SHOUT_CALLBACK:"ext.shout_callback",PARAM_MESSAGE_TYPE:"ext.message_type",PARAM_MESSAGE_RECIPIENTS:"ext.message_recipients",PARAM_ERROR:"error",PARAM_SUCCESS:"success",PARAM_REQUEST_ID:"req.id",OP_STATS_SUBMIT:"stat.submit",PARAM_STATS:"stats",ITEM_LIST:"mtx.item_list",ITEM_CHECKOUT:"mtx.checkout",PURCHASE_KREDS:"mtx.kred_purchase",ITEM_INSTANCES:"mtx.item_instances",USE_ITEM_INSTANCE:"mtx.use_item_instance",PARAM_PURCHASE_METHOD:"purchase_method",PARAM_ITEM_TAGS:"item_tags",PARAM_ITEMS:"items",PARAM_ORDER_INFO:"order_info",PARAM_ID:"id",ADS_INITIALIZE:"ads.initialize",ADS_AVAILABLE:"ads.available",ADS_UNAVAILABLE:"ads.unavailable",ADS_SHOW_INCENTIVIZED:"ads.show_incentivized",AD_OPENED:"ads.ad_opened",AD_COMPLETED:"ads.ad_completed",AD_ABANDONED:"ads.ad_abandoned",PROCESSING_SAVE_SHARED_CONTENT:"processing_save_shared_content",SAVE_SHARED_CONTENT:"save_shared_content",SAVE_SHARED_CONTENT_COMPLETE:"shared_content_save_complete",LOAD_SHARED_CONTENT:"load_shared_content",BROWSE_SHARED_CONTENT:"browse_shared_content",OP_SAVE_SHARED_CONTENT:"save_shared_content",OP_BROWSE_SHARED_CONTENT:"browse_shared_content",OP_LOAD_SHARED_CONTENT:"load_shared_content",OP_SHARED_CONTENT_SAVE_COMPLETE:"shared_content_save_complete",PARAM_CONTENT_TYPE:"content_type",PARAM_LABEL:"label",PARAM_IMAGE:"image",PARAM_PERMALINK:"permalink",OP_IMAGE_AVATAR_SUBMIT:"avatar.submit",OP_IMAGE_AVATAR_FINISHED:"avatar.finished",IMAGE_AVATAR_SUBMIT:"image_avatar_submit",IMAGE_AVATAR_COMPLETE:"image_avatar_complete",OP_ANALYTICS_PAYLOAD:"analytics.payload",HOLODECK_DATA:"holodeck_data",PARAM_HOLODECK_TYPE:"holodeck_type",FETCH_HISTORY:"fetch_history",HISTORY_RECEIVED:"history_received",FAYE_DISCONNECT:"faye_disconnect"},KonduitChatErrorMessage={MESSAGE_TOO_LONG:"error_msg_too_long",RATE_LIMITED:"error_msg_rate_limit",STICKER:"error_msg_sticker"},KonduitPresenceType={CHAT:"chat",AWAY:"away"},Kongregate.polyfillJSON=function(){var toString,isArray,escMap,escFunc,escRE;window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:(toString=Object.prototype.toString,isArray=Array.isArray||function(e){return"[object Array]"===toString.call(e)},escMap={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},escFunc=function(e){return escMap[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},escRE=/[\\"\u0000-\u001F\u2028\u2029]/g,function e(t){if(null==t)return"null";if("number"==typeof t)return isFinite(t)?t.toString():"null";if("boolean"==typeof t)return t.toString();if("object"==typeof t){if("function"==typeof t.toJSON)return e(t.toJSON());if(isArray(t)){for(var n="[",s=0;s<t.length;s++)n+=(s?", ":"")+e(t[s]);return n+"]"}if("[object Object]"===toString.call(t)){var i=[];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&i.push(e(a)+": "+e(t[a]));return"{"+i.join(", ")+"}"}}return'"'+t.toString().replace(escRE,escFunc)+'"'})})},Kongregate.contentLoaded=function(e){var t=window,n=!1,s=!0,i=t.document,a=i.documentElement,r=i.addEventListener,o=r?"addEventListener":"attachEvent",_=r?"removeEventListener":"detachEvent",c=r?"":"on",g=function(s){"readystatechange"==s.type&&"complete"!=i.readyState||(("load"==s.type?t:i)[_](c+s.type,g,!1),!n&&(n=!0)&&e.call(t,s.type||s))},u=function(){try{a.doScroll("left")}catch(e){return void setTimeout(u,50)}g("poll")};if("complete"==i.readyState)e.call(t,"lazy");else{if(!r&&a.doScroll){try{s=!t.frameElement}catch(e){}s&&u()}i[o](c+"DOMContentLoaded",g,!1),i[o](c+"readystatechange",g,!1),t[o](c+"load",g,!1)}},function(){var e;Kongregate.MessageConnection=function(e){this.initialize(e)},Kongregate.MessageConnection.MESSAGE_EVENT="kongregate:api:message",Kongregate.MessageConnection.prototype={initialize:function(t){e=t.channel_id,this._window=t.window||window,this._targetOrigin=t.target_origin,this._targetWindows=t.target_window?[t.target_window]:[],this._sendListener=t.send_listener,this._retryConnection=t.retry_connection||!1,this._messageListeners=[],this._supportsObjects=Kongregate.PostMessage.supportsObjects(),this._client="string"==typeof this._targetOrigin,this._handleMessages=!1,this._connected=!1},addMessageListener:function(e){this._messageListeners.push(e)},isSupported:function(){return!(!this.supportsObjects()&&void 0===this._window.JSON)&&void 0!==(this._targetWindows[0]||window).postMessage},connected:function(){return this._connected},isClient:function(){return this._client},supportsObjects:function(){return this._supportsObjects},logPrefix:function(){return this._client?"[Game:JS]":"[Konduit]"},listen:function(){if(this.isSupported()&&!this._listening){this._listening=!0;var e=this,t=function(t){e.onMessageReceived.call(e,t)};Kongregate.PostMessage.addMessageListener(this._window,t)}},parseMessage:function(e){try{var t=Kongregate.PostMessage.parseMessage(e);if(t&&t.kongregate_type===Kongregate.MessageConnection.MESSAGE_EVENT)return{opcode:t.opcode,params:t.params}}catch(t){Kongregate.Log.warn(this.logPrefix(),"Error parsing message",e,t)}return null},onMessageReceived:function(e){var t=e.origin||e.originalEvent.origin;if(this._targetOrigin&&t!==this._targetOrigin)Kongregate.Log.debug(this.logPrefix(),"Ignoring message from "+t);else{var n=this.parseMessage(e.data);n&&this.processMessage(n,e)}},processMessage:function(e,t){switch(Kongregate.Log.debug(this.logPrefix(),"Message received:",e),e.opcode){case KonduitEvent.CONNECT:this.onClientConnected(e.params,t.source);break;case KonduitEvent.CONNECTED:this.onConnectedToServer()}for(var n=0;n<this._messageListeners.length;n++)this._messageListeners[n](e.opcode,e.params)},sendMessage:function(e,t){if(this.removeMissingWindows(),this.connected()||e===KonduitEvent.CONNECT||e===KonduitEvent.CONNECTED){var n={kongregate_type:Kongregate.MessageConnection.MESSAGE_EVENT,opcode:e,params:"string"==typeof t?JSON.parse(t):t};this.supportsObjects()||(n=JSON.stringify(n));for(var s=this._targetOrigin||"*",i=0;i<this._targetWindows.length;i++)this._targetWindows[i].postMessage(n,s);this._sendListener&&this._sendListener(e,t)}else Kongregate.Log.debug(this.logPrefix(),"Not sending "+e+", not connected")},connect:function(){this.connected()||(this.listen(),Kongregate.Log.debug("Attempting to connect to Kongregate API"),this.sendMessage(KonduitEvent.CONNECT,{chnl:e}),this._retryConnection&&this.retryConnection())},retryConnection:function(){var e=this;setTimeout((function(){e.connect()}),5e3)},onClientConnected:function(t,n){t.chnl===e?(Kongregate.Log.debug(this.logPrefix(),"API connection established!"),this.acceptClientConnection(n)):Kongregate.Log.warn(this.logPrefix(),"Channel ID mismatch, ignoring connect")},onConnectedToServer:function(){this.connected()||(Kongregate.Log.debug(this.logPrefix(),"API connection established!"),this._connected=!0)},acceptClientConnection:function(e){for(var t=!1,n=this._targetWindows,s=0;s<this._targetWindows.length;s++)if(this._targetWindows[s]===e){Kongregate.Log.warn("Re-initializing duplicate connection"),t=!0;break}this._targetWindows=[e],this.sendMessage(KonduitEvent.CONNECTED,{}),this._targetWindows=n,t||this._targetWindows.push(e),this.removeMissingWindows()},removeMissingWindows:function(){if(!this._client){for(i=this._targetWindows.length-1;i>=0;i--)this._targetWindows[i].top||this._targetWindows.splice(i,1);this._connected=this._targetWindows.length>0}}}}(),Kongregate.PostMessage={addMessageListener:function(e,t){if(e.document.addEventListener)try{e.document.addEventListener.call(e,"message",t,!1)}catch(n){Kongregate.Log.debug("addEventListener failed, using iframe addEventListener: "+n),Kongregate.PostMessage.createIframeEventListener(e,t)}else e.attachEvent?e.attachEvent("onmessage",t):Kongregate.Log.error("Could not add event listener, neither addEventListener or attachEvent found!");return t},removeMessageListener:function(e,t){e.removeEventListener?e.removeEventListener("message",t):e.detachEvent&&e.detachEvent("onmessage",t)},supportsObjects:function(){var e=document.createElement("iframe"),t=!0;e.src="about:blank",document.body.appendChild(e);try{e.contentWindow.postMessage({toString:function(){return t=!1,""}},"*")}catch(e){}return document.body.removeChild(e),t},parseMessage:function(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):"object"==typeof e?e:null},createIframeEventListener:function(e,t){var n=document.createElement("iframe");n.src="about:blank",document.head.appendChild(n),n.contentWindow.addEventListener.call(e,"message",t,!1),document.head.removeChild(n)}},function(){Kongregate.Utils.merge=function(e,t){if(!e||!t)return e;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},Kongregate.Utils.toW3CDTF=function(e){function t(e){return e<10?"0"+e:e}return e instanceof Date?e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"-00:00":""},Kongregate.Utils.parseW3CDTF=function(t,n){var s;try{var i,a=0,r=[1,4,5,6,7,10,11];if(i=e.exec(t)){for(var o,_=0;o=r[_];++_)i[o]=+i[o]||0;i[2]=(+i[2]||1)-1,i[3]=+i[3]||1,"Z"!==i[8]&&void 0!==i[9]&&(a=60*i[10]+i[11],"+"===i[9]&&(a=0-a)),s=new Date(Date.UTC(i[1],i[2],i[3],i[4],i[5]+a,i[6],i[7]))}if(!s||"Invalid Date"===s.toString())throw new Error("This date does not conform to W3CDTF.")}catch(e){var c="Unable to parse the string ["+t+"] into a date. ";return c+="The internal error was: "+e.toString(),Kongregate.Log.error(c),n}return s},Kongregate.Utils.indexOf=function(e,t){if(!e)return-1;if("function"==typeof e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};var e=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/}(),function(){Kongregate.AnalyticsClient=function(e){this.initialize(e)};var e=Kongregate.AnalyticsClient,t=["auto_event","retry_count"];Kongregate.AnalyticsClient.prototype={initialize:function(e){this._type="kong",this._applicationId=e.application_id,this._apiKey=e.api_key,this._eventQueue=e.event_queue||[],this._url=e.url,this._requestHeaders=e.request_headers||{},this._submitting=!1},enqueueEvent:function(e){this._filterEvent(e)&&this._eventQueue.push(e)},sendEvents:function(e){var t=new XMLHttpRequest,n=this._eventQueue,s=n.length,i=this;if(!this._submitting&&s){this._submitting=!0;var a=function(t){i._submitting=!1,i._onError(n,s,t,e)};for(var r in Kongregate.Log.debug("Flushing "+this._type+" event queue"),t.open("POST",this._url),t.setRequestHeader("Content-Type","application/json; charset=utf-8"),this._requestHeaders)this._requestHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this._requestHeaders[r]);t.onerror=t.onabort=a,t.onload=function(){i._submitting=!1,i._onBatchResponse(t,n,s,e,a)},void 0!==t.timeout&&(t.timeout=3e4,t.ontimeout=a),t.send(JSON.stringify(this._createPayload(n)))}},_filterEvent:function(e){return 0!==e.name.indexOf(n.SWRVE_EVENT_IDENTIFIER)},_validateResponse:function(){return!0},_onBatchResponse:function(e,t,n,s,i){var a=!1,r=e.status||0;if(200===r||202===r){e.responseText;a=this._validateResponse(e.responseText)}if(a)Kongregate.Log.debug(this._type+" submission complete, "+n+" event(s)"),t.splice(0,n),s&&s({success:!0});else{var o=r<500;Kongregate.Log.error("Error submitting "+this._type+" httpStatus: "+r+", numEvents: "+n+", fatal: "+o),i(o)}},_onError:function(e,t,n,s){for(var i=0;i<t&&i<e.length;i++){var a=e[i];if(a){var r=(a.event.retry_count||0)+(n?this._maxRetries()+1:1);a.event.retry_count=r}}this._pruneEvents(e),s&&s({success:!1})},_createPayload:function(e){for(var t=[],n={events:t},s=0;s<e.length;s++){var i=e[s],a=i.name,r=Kongregate.Utils.merge({},i.event);this._removeTransientProperties(r),t.push({event_type:a,payload:r})}return n},_pruneEvents:function(e){for(var t=e.length-1;t>=0;t--)e[t].event&&e[t].event.retry_count>this._maxRetries()&&(Kongregate.Log.debug("Event "+e[t].name+" is over max retry count, deleting it"),e.splice(t,1));var n=this._maxBacklogSize();e&&e.length>n&&e.splice(0,e.length-n)},_removeTransientProperties:function(e){for(var n=0;n<t.length;n++){var s=t[n];void 0!==e[s]&&delete e[s]}},_maxRetries:function(){return 2},_maxBacklogSize:function(){return 100},_getDate:function(){return new Date},_getTime:function(e){var t=this._getDate();if(e.event?e.event[Kongregate.AnalyticsServices.KONG_ANALYTICS_EVENT_TIME]:null){var n=e.event[Kongregate.AnalyticsServices.KONG_ANALYTICS_EVENT_TIME];t=Kongregate.Utils.parseW3CDTF(n,this._getDate())}return Math.floor(t.getTime()/1e3)}},Kongregate.SwrveClient=function(e){this.initialize(e)};var n=Kongregate.SwrveClient;n.prototype=Kongregate.Utils.merge({},e.prototype),Kongregate.Utils.merge(n.prototype,{initialize:function(t){e.prototype.initialize.call(this,t),this._type="swrve",this._playerId=t.player_id,this._clientVersion=t.client_version},_filterEvent:function(){return!0},_validateResponse:function(e){var t=0===e.length;t||(t=200===JSON.parse(e).code);return t},_createPayload:function(e){for(var t=[],s={app_version:this._clientVersion,session_token:this._createSessionToken(),user:this._playerId,data:t},i=0;i<e.length;i++){var a=e[i],r=a.name,o=this._getTime(a),_=Kongregate.Utils.merge({},a.event);this._removeTransientProperties(_),n.SWRVE_SESSION_START_IDENTIFIER===r?t.push({type:"session_start",time:o}):n.SWRVE_USER_IDENTIFIER===r?t.push({type:"user",time:o,attributes:_}):n.SWRVE_IAP_IDENTIFIER===r?t.push(Kongregate.Utils.merge({type:"iap",time:o},_)):0===r.indexOf(n.SWRVE_EVENT_IDENTIFIER)?(r=r.replace(n.SWRVE_EVENT_IDENTIFIER,"Kongregate."),t.push({type:"event",name:r,time:o,payload:_})):(r="Kongregate.RawData."+r,t.push({type:"event",name:r,time:o,payload:{data:JSON.stringify(_)}}))}return s},_createSessionToken:function(){var e=Math.floor(this._getDate().getTime()/1e3);return this._applicationId+"="+this._playerId+"="+String(e)+"="+Kongregate.Utils.md5(this._playerId+String(e)+this._apiKey)}}),n.SWRVE_EVENT_IDENTIFIER="swrve.",n.SWRVE_BARE_EVENT_IDENTIFIER=n.SWRVE_EVENT_IDENTIFIER+"__bare_",n.SWRVE_SESSION_START_IDENTIFIER=n.SWRVE_BARE_EVENT_IDENTIFIER+"session_start",n.SWRVE_USER_IDENTIFIER=n.SWRVE_BARE_EVENT_IDENTIFIER+"user",n.SWRVE_IAP_IDENTIFIER=n.SWRVE_BARE_EVENT_IDENTIFIER+"iap"}(),function(){Kongregate.AnalyticsServices=function(e){this.initialize(e)},Kongregate.AnalyticsServices.prototype={initialize:function(e){var t=this;this._heartbeatInterval=e.heartbeat_interval||15e3,this._services=e.services,this._clients=e.clients||{},this._mtx=e.mtx,this._kongVars=e.kongregate_variables,this._staticVars={},this._persistentStore=e.persistent_store||{},this._heartbeatCount=0,this._enablePersistence=e.enable_persistence&&!e.persistent_store,this._services.addEventListener(KonduitEvent.KONDUIT_MESSAGE,(function(e){t._onIncomingMessage(e.opcode,e.params)})),e.start&&this._setup()},addEvent:function(e,t){this._enabled&&(!this._autoAnalyticsDisabled()&&Kongregate.Utils.indexOf(Re,e)>=0?Kongregate.Log.warn("Ignoring analytics event: "+e+" since it is a kong-automatic event."):this._addEventInternal(e,this._objectify(t)))},addFilterType:function(e){if(this._enabled&&e)if(e&&/^[a-zA-Z0-9_]+$/.test(e)){var t=this._savedData[S],n=t?t.split(","):[];Kongregate.Utils.indexOf(n,e)<0&&(n.push(e),n.sort(),this._savedData[S]=n.join(","),this._flushPersistentStore(),Kongregate.Log.info("Filter type added: "+e))}else Kongregate.Log.warn("Invalid filterType: "+e+", must be alpha_numeric")},setCommonPropsCallback:function(e){this._enabled&&(this._commonPropsCallback=e,this.updateCommonProperties())},setCommonProperties:function(e){e=this._objectify(e),this.setCommonPropsCallback((function(){return e}))},updateCommonProperties:function(){try{"function"==typeof this._commonPropsCallback&&(this._commonProperties=this._objectify(this._commonPropsCallback()),this._savedData[ke]=this._commonProperties,this._commonProperties[j]&&!this._savedData[P]&&(this._savedData[P]=this._commonProperties[j]))}catch(e){Kongregate.Log.error("Error updating common properties: "+e)}},getAutoLongProperty:function(e){return this.getAutoIntProperty(e)},getAutoLongLongProperty:function(e){return this.getAutoLongProperty(e)},getAutoStringProperty:function(e){if(!this._enabled)return null;var t=this._getKongAutomaticVariables();return"string"==typeof t[e]?t[e]:(Kongregate.Log.warn("Property is not a string: "+e),null)},getAutoBoolProperty:function(e){return!!this._enabled&&!!this._getKongAutomaticVariables()[e]},getAutoDoubleProperty:function(e){if(!this._enabled)return NaN;var t=this._getKongAutomaticVariables();return Number(t[e])},getAutoIntProperty:function(e){return this._enabled?Math.floor(this.getAutoDoubleProperty(e)):NaN},getAutoUTCProperty:function(e){return this.getAutoStringProperty(e)},getAutoPropertiesJSON:function(){return this._enabled?(this._buildKongAutomaticVariables(),"function"==typeof JSON.stringify?JSON.stringify(this._automaticVars):"{}"):"{}"},startPurchase:function(e,t){if(!this._autoAnalyticsDisabled()){var n=this._getProductId(e);n?(this._priceUSD=this._getUSDPrice(n,t),this._iapID&&Kongregate.Log.warn("startPurchase: invoked before active transaction finished. iap_ids may mismatch."),Kongregate.Log.debug("IAP FLOW STEP: startPurchase(): "+n),this._iapID=this._uuid(),this._productId=n,this._addIAPEvent(null,this._objectify(t),Ee)):Kongregate.Log.warn("startPurchase: Can't start purchase with null productId, param was: "+e)}},finishPurchase:function(e,t,n){this._autoAnalyticsDisabled()||(Kongregate.Log.debug("IAP FLOW STEP: finishPurchase(): "+this._productId+", transactionId: "+t+", resultCode: "+e),Pe===e?(this._numPurchases++,this._totalSpentUSD+=this._priceUSD,this._addIAPEvent(t,this._objectify(n),fe)):this._addIAPFailEvent(t,this._objectify(n)))},setAutomaticVariablesListener:function(e){this._enabled&&(this._automaticVarsListener=e,this._getKongAutomaticVariables())},start:function(){},_setup:function(){if(!this._savedData){var t=this._services.isKongregate();if(this._mode=t?this._kongVars.kongregate_analytics_mode:null,this._enabled=null!==this._mode&&void 0!==this._mode&&this._checkBrowserSupport(),Kongregate.Log.debug("Initializing Analytics API, mode: "+this._mode),this._enabled){this._enablePersistence&&this._hasLocalStorage()&&this._loadPersistentStore(),this._clientVersion=t?this._kongVars.kongregate_game_version:"1",this._pendingEvents=this._persistentStore.pending_events=this._persistentStore.pending_events||[],this._eventQueues=this._persistentStore.event_queues=this._persistentStore.event_queues||{},this._eventQueues.swrve=this._eventQueues.swrve||[],this._eventQueues.kong=this._eventQueues.kong||[],this._savedData=this._persistentStore.saved_data=this._persistentStore.saved_data||{},this._items=this._persistentStore.items=this._persistentStore.items||[],this._commonProperties=this._savedData.common_properties=this._savedData.common_properties||{},this._bundleId=this._savedData[r],this._autoAnalyticsDisabled()?Kongregate.Log.debug("Auto analytics disabled"):this._autoAnalyticsExcludesServer()?Kongregate.Log.debug("Game has a server, only tracking a subset of analytics automatically"):Kongregate.Log.debug("Automatic analytics enabled"),t&&this._requestItems();var n=this._getDate(),s=!this._savedData[y];this._setInitialSavedData(y,this._toW3CDTF(n)),this._setInitialSavedData(K,e),this._setInitialSavedData(I,this._clientVersion),this._setInitialSavedData(T,this._timeZoneOffset()),s&&(Kongregate.Log.debug("Analytics: First play"),this._installEvent()),this._startSession(),this._buildKongStaticVars()}else Kongregate.Log.debug("Analytics API not enabled")}},_enqueueEvent:function(e,t){return!this._initialized&&(this._autoAnalyticsDisabled()&&t[ne]||(Kongregate.Log.debug("Queueing pending event: "+e),this._pendingEvents.push({name:e,event:t})),!0)},_addEventInternal:function(e,t,n){var s=0===e.indexOf(Kongregate.SwrveClient.SWRVE_EVENT_IDENTIFIER);if(s||t[te]||(t=this._merge(this._buildEventSpecificVariables(),t)),!this._enqueueEvent(e,t)&&this._enabled){Ce===e&&this._refreshPlayerInfoFields(t);var i=this._getKongAutomaticVariables(),a={};s?a=t:(this._merge(a,this._objectify(this._commonProperties)),t[ne]?(this._merge(a,i),this._merge(a,t)):(this._merge(a,t),this._merge(a,i))),Kongregate.SwrveClient.SWRVE_SESSION_START_IDENTIFIER===e&&(n=!0),Kongregate.Log.debug("Adding event: "+e+", flush="+n),this._forEachClient((function(t){return t.enqueueEvent({name:e,event:a})})),this._flushQueue(),n&&this._flushPersistentStore()}},_forEachClient:function(e){for(var t in this._clients)this._clients.hasOwnProperty(t)&&e(this._clients[t])},_flushQueue:function(){var e=this;this._forEachClient((function(t){t.sendEvents((function(t){e._flushPersistentStore(),e._flushQueueDelayed(t.success?1e3:1e4)}))}))},_flushQueueDelayed:function(e){var t=this;setTimeout((function(){t._flushQueue()}),e)},_persistentStoreName:function(){return Kongregate.AnalyticsServices.persistentStoreName(this._kongVars.kongregate_game_id)},_loadPersistentStore:function(){var e;try{var t=localStorage.getItem(this._persistentStoreName())||"{}";e=JSON.parse(t)}catch(e){Kongregate.Log.warn("Error loading persistent store: "+e)}this._persistentStore=e||{}},_flushPersistentStore:function(){try{var e=JSON.stringify(this._persistentStore);localStorage.setItem(this._persistentStoreName(),e)}catch(e){Kongregate.Log.warn("Error flushing persistent store: "+e)}},_destroyPersistentStore:function(){localStorage.removeItem(this._persistentStoreName())},_buildEventSpecificVariables:function(){var e={};return e[te]=0,this._autoAnalyticsDisabled()||(e[f]=this._uuid(),e[m]=this._toW3CDTF(this._getDate()),e[Q]=this._timeZoneOffset()),e},_refreshPlayerInfoFields:function(e){e[Oe]=this._savedData[Oe],e[Me]=this._savedData[Me];for(var t=0;t<Le.length;t++){var n=Le[t];e[n]?this._savedData[n]=e[n]:e[n]=this._savedData[n]?this._savedData[n]:null}},_addAutoEvent:function(e,t){this._autoAnalyticsDisabled()||((t=this._objectify(t))[ne]=!0,this._addEventInternal(e,t))},_addIAPEvent:function(e,t,n){var s={};this._merge(s,this._objectify(t)),s[me]=this._priceUSD,s[Ae]=this._productId,s[Se]=this._iapID,Ee!=n&&(s[Te]=e||be),this._services.isKongregate()?(s[Ke]=this._getKredPrice(this._productId),s[ye]="KRED"):(s[Ke]=t[Ke]||this._priceUSD,s[ye]=t[ye]||"USD"),fe===n&&(this._sendSwrveIAPEvent(this._productId,this._priceUSD,t),this._iapID=null,this._productId=null,this._priceUSD=0),this._addEventInternal(n,s)},_addIAPFailEvent:function(e,t){var n={};this._merge(n,this._objectify(t)),n[Ie]="SKErrorPaymentCancelled",n[Te]=e||be,n[Se]=this._iapID,this._iapID=null,this._productId=null,this._priceUSD=0,this._addEventInternal(pe,n)},_sendSwrveUserEvent:function(){if(!this._autoAnalyticsDisabled()){for(var e=this._getKongAutomaticVariables(),t={},n=0;n<Ne.length;n++){var s=Ne[n];t["kong."+s]=e[s]}this._addAutoEvent(Kongregate.SwrveClient.SWRVE_USER_IDENTIFIER,t)}},_sendSwrveIAPEvent:function(e,t,n){var s={product_id:e,quantity:1,local_cost:t,local_currency:"USD",app_store:"unknown_store"},i={};i[e]={type:"item",amount:1},n.soft_currency_change&&(i.soft_currency_change={type:"currency",amount:n.soft_currency_change}),n.hard_currency_change&&(i.hard_currency_change={type:"currency",amount:n.hard_currency_change}),n.type&&(i[n.type]={type:"item",amount:1}),s.rewards=i,this.addEvent(Kongregate.SwrveClient.SWRVE_IAP_IDENTIFIER,s)},_onIncomingMessage:function(e,t){e===KonduitEvent.OP_ANALYTICS_PAYLOAD&&this._processAnalyticsPayload(t.data.info,t.data.payload)},_setInitialSavedData:function(e,t){this._savedData[e]||(this._savedData[e]=t)},_autoAnalyticsDisabled:function(){return!this._enabled||this._mode===n},_autoAnalyticsAllEnabled:function(){return this._enabled&&this._mode===s},_autoAnalyticsExcludesServer:function(){return this._enabled&&this._mode===i},_getProductId:function(e){try{if("string"==typeof e)return e;if(Number(parseFloat(e))==e)return e.toString();if("[object Array]"===Object.prototype.toString.call(e)){if(e.length>0)return this._getProductId(e[0])}else if("string"==typeof e.identifier)return e.identifier}catch(e){Kongregate.Log.error("Error calculating product ID:",e)}return Kongregate.Log.warn("Couldn't get product ID from: "+e+", type="+typeof e),null},_getUSDPrice:function(e,t){if(this._services.isKongregate()){var n=this._getKredPrice(e);if(0!==n){var s=n*this._kredExchangeRate;return Math.floor(100*s)/100}}else if(t&&t[me])return t[me];var i=/^.*t([0-9][0-9])_.*$/,a=e.match(i);if(a&&2===a.length){var r=parseInt(a[1],10);if(r>0&&r<=we.length)return we[r-1]}return Kongregate.Log.warn("Couldn't calculate USD price for identifier: "+e),0},_getKredPrice:function(e){for(var t=0;t<this._items.length;t++){var n=this._items[t];if(e===n.identifier)return n.price}return Kongregate.Log.warn("Couldn't get kred price for identifier: "+e),0},_requestItems:function(e){if((e=e||0)>5)Kongregate.Log.error("Giving up on retrieving item list");else{var t=this;this._mtx.requestItemList(null,(function(n){n.success?t._items=t._persistentStore.items=n.data:t._retryRequestItems(e+1)}))}},_retryRequestItems:function(e){var t=this;Kongregate.Log.warn("Retrying item list request, retry #"+e),setTimeout((function(){t.requestItems(e)}),15e3*e)},_processAnalyticsPayload:function(e,t){if(Kongregate.Log.info("Analytics payload received"),this._enabled)if(this._checkBrowserSupport(t)){this._config=e;var n=this._config.swrve,s=this._config.kong;if(this._svid=t.site_visitor_uid,t.kger&&(this._kredExchangeRate=t.kger),this._updateKongStaticVars(t),!this._initialized){if(this._initialized=!0,!this._clients.swrve&&n&&n.application_id&&n.key&&(Kongregate.Log.debug("Swrve initialized"),this._clients.swrve=new Kongregate.SwrveClient({application_id:n.application_id,api_key:n.key,url:n.url,player_id:this._services.isKongregate()?this._svid:this._savedData[B],client_version:this._clientVersion,event_queue:this._eventQueues.swrve})),!this._clients.kong&&s&&s.application_id&&s.key&&(Kongregate.Log.debug("Kong analytics initialized"),this._clients.kong=new Kongregate.AnalyticsClient({application_id:s.application_id,api_key:s.key,url:s.url,event_queue:this._eventQueues.kong,request_headers:{"X-Api-Key":s.key}})),!this._clients.swrve&&!this._clients.kong)return Kongregate.Log.debug("Analytics not initialized, no services configured"),void(this._enabled=!1);this._submitLock=!1,this._startHeartbeatTimer(),this._flushPendingEvents(),this._sendSwrveUserEvent(),this.addEvent(Ce,{}),this._flushQueue()}}else this._enabled=!1},_checkBrowserSupport:function(e){try{if(e&&"safari"===e.browser.browser.toLowerCase())Kongregate.Log.warn("Analytics disabled on Safari");else{if(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)return!0;Kongregate.Log.warn("Analytics disabled due to lack of XHR/CORS support")}}catch(e){Kongregate.Log.warn("Error while checking browser support: "+e)}return!1},_hasLocalStorage:function(){try{var e="kong-"+this._getDate().getTime();return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},_startHeartbeatTimer:function(){if(this._heartbeatInterval){var e=this;setInterval((function(){e._onHeartbeatInterval()}),this._heartbeatInterval)}},_onHeartbeatInterval:function(){this._heartbeatCount+=1,this._session.active=this._getDate().getTime(),4==this._heartbeatCount&&(this._heartbeatCount=0,this.addEvent(De,{}))},_flushPendingEvents:function(){if(this._pendingEvents.length>0){Kongregate.Log.debug("Flushing "+this._pendingEvents.length+" pending event(s)");for(var e=0;e<this._pendingEvents.length;e++){var t=this._pendingEvents[e];this._addEventInternal(t.name,t.event,!1)}this._pendingEvents.length=0}},_buildKongStaticVars:function(){if(!this._autoAnalyticsDisabled()){var t=this._services.isKongregate();this._staticVars[r]=this._bundleId,this._staticVars[V]=this._services.getUsername(),this._staticVars[k]=this._services.getUserId(),this._staticVars[Z]=t?this._svid:"",this._staticVars[z]=this._session.id,this._staticVars[q]=e,this._staticVars[F]=this._numSessions(),this._staticVars[h]=this._clientVersion,this._staticVars[E]=this._clientVersion,this._staticVars[I]=this._savedData[I],this._staticVars[P]=this._savedData[P]||null,this._staticVars[$]="kongregate_web",this._autoAnalyticsExcludesServer()||(this._staticVars[B]=t?this._svid:this._savedData[B]),this._staticVars[p]="browser",this._staticVars[W]=null,this._staticVars[y]=this._savedData[y],this._staticVars[K]=this._savedData[K],this._staticVars[T]=this._savedData[T],this._staticVars[H]=this._kongVars.kongregate_language||(window.navigator.userLanguage||window.navigator.language).split("-")[0],this._staticVars[O]=null,this._staticVars[R]=null,
this._staticVars[N]=null,this._staticVars[L]=null,this._staticVars[a]=!1,this._staticVars[l]="wifi",this._staticVars[c]=null,this._staticVars[b]=null,this._staticVars[C]=null,this._staticVars[w]=!0,this._staticVars[ee]="web"}},_buildKongAutomaticVariables:function(){if(this._autoAnalyticsDisabled())this._automaticVars={};else{var e={};e[S]=this._savedData[S]||"",e[G]=this._numPurchases,e[v]=this._daysRetained(),this._autoAnalyticsExcludesServer()||(e[J]=this._totalSpentUSD),this._automaticVars=this._merge(e,this._staticVars)}},_updateKongStaticVars:function(e){if(!this._autoAnalyticsDisabled()){this._bundleId="com.kongregate.web."+e.game_permalink,this._services.isExternal()&&(this._bundleId+=".external"),this._savedData[r]=this._bundleId,this._buildKongStaticVars();var t=this._parseOS(e.browser.os);this._staticVars[g]=t.type,this._staticVars[u]=t.version,this._staticVars[U]=e.premium,this._staticVars[M]=e.powerup_rewards_tier,this._savedData[Oe]=e.pur_link_date||null,this._savedData[Me]=e.join_date||null,this._staticVars[X]=Number(e.spent_on_kreds),this._totalSpentUSD=e.spent_usd,this._numPurchases=e.num_purchases,this._staticVars[o]=e.browser.browser,this._staticVars[_]=e.browser.version,this._staticVars[D]=e.ip_address,this._staticVars[A]=e.ip_address;var n=this._getDate(),s=Math.abs(n.getTime()-this._parseW3CDTF(e.server_time,n).getTime())/1e3;this._staticVars[Y]=Math.floor(s),this._savedData[x]=e.server_time,this._staticVars[d]=e.country_code,this._getKongAutomaticVariables()}},_getKongAutomaticVariables:function(){return this._enabled?(this.updateCommonProperties(),this._buildKongAutomaticVariables(),this._automaticVarsListener&&this._automaticVarsListener(this._automaticVars),this._automaticVars):{}},_startSession:function(){var e=this._getDate();this._previousSession=this._savedData.current_session;var n=this._previousSession?(e.getTime()-this._previousSession.active)/1e3:0,s=this._previousSession?(e.getTime()-this._previousSession.start)/1e3:0;if(n>t){Kongregate.Log.debug("Terminating previous session ("+this._previousSession.id+"), inactiveFor="+n+", length="+s);var i={};i[z]=this._previousSession.id,i[F]=this._numSessions(),i[oe]=this._toW3CDTF(this._previousSession.active),i[re]=s,i[_e]=!1,this._addAutoEvent(ae,i)}else this._previousSession&&(this._session=this._previousSession,Kongregate.Log.debug("Reopening previous session ("+this._previousSession.id+"), inactiveFor="+n+", length="+s));if(!this._session){this._session={id:this._uuid(),start:e.getTime(),active:e.getTime()},this._savedData.current_session=this._session;var a=this._savedData[F]?this._numSessions()+1:1;this._savedData[F]=a,Kongregate.Log.debug("Created new session: "+this._session.id)}if(this._session!=this._previousSession){this.addEvent(Kongregate.SwrveClient.SWRVE_SESSION_START_IDENTIFIER,{});var r={};r[ie]=!1,this._addAutoEvent(se,r)}},_installEvent:function(){if(this._autoAnalyticsAllEnabled()){var e={};e[ge]=null,e[ue]=null,e[he]=null,e[de]=null,e[le]=null,e[ve]=null,this._addAutoEvent(ce,e)}else Kongregate.Log.debug("Not firing installs event since analytics mode is not all")},_parseOS:function(e){var t="Unknown",n="Unknown";try{var s=e.split(" ");if(s.length<2)throw new Error("Not enough segments in OS string");"OS"===(t=s.shift())&&(t="MacOS",s.shift()),n=s.join(" ")}catch(t){Kongregate.Log.error("Error parsing OS version ("+e+"): "+t.toString())}return{type:t,version:n}},_numSessions:function(){return this._savedData[F]||1},_timeZoneOffset:function(){return this._getDate().getTimezoneOffset()/-60},_daysRetained:function(){var e=this._getDate(),t=this._timeZoneOffset(),n=this._staticVars[y];return n&&null===(e=this._parseW3CDTF(n,null))&&(Kongregate.Log.warn("Failed to parse first play date: "+n+", resetting"),e=this._getDate(),this._savedData[y]=this._toW3CDTF(e),this._flushPersistentStore()),this._staticVars[T]&&(t=this._staticVars[T]),this._daysSince(e,t)},_dayOfEra:function(e,t){return t*=3600,Math.floor((e+t)/86400)},_daysSince:function(e,t){var n=Math.floor(this._getDate()/1e3),s=Math.floor(e.getTime()/1e3);return this._dayOfEra(n,this._timeZoneOffset())-this._dayOfEra(s,t)},_objectify:function(e){if("string"==typeof e){if(0===e.length||"function"!=typeof JSON.parse)return{};try{return JSON.parse(e)||{}}catch(t){return Kongregate.Log.warn("Failed to parse JSON: "+e+", error: "+t),{}}}return e},_toW3CDTF:function(e){return Kongregate.Utils.toW3CDTF(e)},_parseW3CDTF:function(e,t){return Kongregate.Utils.parseW3CDTF(e,t)},_uuid:function(){var e=this._getDate().getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))},_merge:function(e,t){return Kongregate.Utils.merge(e,t)},_getDate:function(){return new Date}};var e="2.0.0",t=300,n="none",s="all",i="cloud",a="ad_tracking",r="bundle_id",o="browser",_="browser_version",c="carrier",g="client_os_type",u="client_os_version",h="client_version",d="country_code",l="data_connection_type",v="days_retained",E="dev_client_version",f="device_event_id",p="device_type",m="event_time",A="external_ip_address",S="filter_type",I="first_client_version",T="first_play_time_offset",y="first_play_time",K="first_sdk_version",P="first_server_version",b="gamecenter_id",C="gamecenter_alias",M="pur_tier",O="idfa",R="idfv",L="imei",N="android_id",D="ip_address",w="is_valid",k="kong_user_id",V="kong_username",U="kong_plus",H="lang_code",x="last_skew_refresh_time",G="num_purchases",F="num_sessions",W="mac_address",B="player_id",q="sdk_version",j="server_version",z="session_id",Y="time_skew",J="total_spent_in_usd",Q="event_time_offset",Z="site_visitor_id",X="usd_spent_on_kreds",$="platform",ee="pkg_src",te="retry_count",ne="auto_event",se="session_starts",ie="is_from_background",ae="session_ends",re="session_length_seconds",oe="session_end_time",_e="did_crash",ce="installs",ge="stub_field",ue="utm_source",he="utm_medium",de="utm_term",le="utm_content",ve="utm_campaign",Ee="iap_attempts",fe="iap_transactions",pe="iap_fails",me="usd_cost",Ae="product_id",Se="iap_id",Ie="fail_reason",Te="receipt_id",ye="local_currency_type",Ke="local_currency_cost",Pe="SUCCESS",be="none",Ce="player_info",Me="kong_join_date",Oe="pur_link_date",Re=[ce,se,ae,"foreground_visits","background_visits",Ee,pe,fe,"invalid_states"],Le=["twitter_id","fb_user_id","fb_username","fb_email","email"],Ne=[J,y,F,v,p,g,u,d,V,z,O,R,h],De="swrve.heartbeat",we=[.99,1.99,2.99,3.99,4.99,5.99,6.99,7.99,8.99,9.99,10.99,11.99,12.99,13.99,14.99,15.99,16.99,17.99,18.99,19.99,20.99,21.99,22.99,23.99,24.99,25.99,26.99,27.99,28.99,29.99,30.99,31.99,32.99,33.99,34.99,35.99,36.99,37.99,38.99,39.99,40.99,41.99,42.99,43.99,44.99,45.99,46.99,47.99,48.99,49.99,54.99,59.99,64.99,69.99,74.99,79.99,84.99,89.99,94.99,99.99,109.99,119.99,124.99,129.99,139.99,149.99,159.99,169.99,174.99,179.99,189.99,199.99,209.99,219.99,229.99,239.99,249.99,299.99,349.99,399.99,449.99,499.99,599.99,699.99,799.99,899.99,999.99],ke="common_properties";Kongregate.AnalyticsServices.KONG_ANALYTICS_EVENT_TIME=m,Kongregate.AnalyticsServices.persistentStoreName=function(e){return"kong-game-analytics-"+e}}(),Kongregate.ApiServices=function(e){this.initialize(e)},Kongregate.ApiServices.prototype={initialize:function(e){this._kongVars=e.kongregate_variables||{},this._messageConnection=e.message_connection,this._eventListeners={},this._requestHandlers={},this._messageQueue=[],this._requestId=0,this._initializeKongVars(this._kongVars),this.initializeEventListeners()},initializeEventListeners:function(){var e=this;this._messageConnection.addMessageListener((function(t,n){e._onIncomingMessage(t,n)}))},_initializeKongVars:function(e){e=e||{},this._kongregate="true"===String(e.kongregate),this._username=e.kongregate_username||"Guest",this._authToken=e.kongregate_game_auth_token,this._userId=parseInt(e.kongregate_user_id,10)||0,this._gameId=parseInt(e.kongregate_game_id,10)||0},addEventListener:function(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)},_dispatchEvent:function(e,t){for(var n=this._eventListeners[e]||[],s=0;s<n.length;s++)n[s](t||{})},connect:function(){},connectExternal:function(){Kongregate.Log.warn("The Kongregate externally hosted API is not available")},isExternal:function(){return!this.isKongregate()},isKongregate:function(){return this._kongregate},getUsername:function(){return this._username},getGameAuthToken:function(){return this._authToken},getUserId:function(){return this._userId},getUserID:function(){return this.getUserId()},getGameId:function(){return this._gameId},getGameID:function(){return this.getGameId()},isGuest:function(){return 0===this.getUserId()},isConnected:function(){return this._messageConnection.connected()&&!this._messageQueue},sendMessage:function(e){if(!this.isConnected())return Kongregate.Log.debug("Queueing message "+e.opcode+" since API is not yet connected!"),void this._messageQueue.push(e);this._messageConnection.sendMessage(e.opcode,e.params)},_flushMessageQueue:function(){if(this._messageQueue){var e=this._messageQueue;this._messageQueue=null,Kongregate.Log.debug("Flushing message queue",e);for(var t=0;t<e.length;t++)this.sendMessage(e[t])}},_onIncomingMessage:function(e,t){switch(e){case KonduitEvent.OP_CONNECTED:this.sendMessage({opcode:KonduitEvent.OP_HELLO,params:{}}),this._flushMessageQueue();break;case KonduitEvent.OP_EXTERNAL_MESSAGE:this._onIncomingMessage(t.opcode,t.data);break;case KonduitEvent.OP_SHOUT_CALLBACK:this._onShoutResponse(t);break;case KonduitEvent.OP_USER_INFO:this._onUserInfo(t)}this._dispatchEvent(KonduitEvent.KONDUIT_MESSAGE,{opcode:e,params:t})},_onShoutResponse:function(e){this._completeRequest(e,{type:e[KonduitEvent.PARAM_MESSAGE_TYPE],recipients:e[KonduitEvent.PARAM_MESSAGE_RECIPIENTS],success:e.success,error:e.error})},_onUserInfo:function(e){var t=e[KonduitEvent.PARAM_USER_ID];if(0!==t){var n=this.isGuest();this._username=e[KonduitEvent.PARAM_USER],this._authToken=e[KonduitEvent.PARAM_GAME_AUTH_TOKEN],this._userId=t,n&&this._dispatchEvent(KonduitEvent.LOGIN)}},privateMessage:function(e,t){if(this._ensureKongregate(t)){var n={shout_message:("string"==typeof e?e:e.content)||""};this._enqueueRequest(n,t),this.sendMessage({opcode:KonduitEvent.OP_CHAT_PRIVATE_MESSAGE,params:n})}},resizeGame:function(e,t){if(this._ensureKongregate()){var n={};n[KonduitEvent.PARAM_RESIZE_GAME_WIDTH]=e,n[KonduitEvent.PARAM_RESIZE_GAME_HEIGHT]=t,this.sendMessage({opcode:KonduitEvent.OP_CHAT_RESIZE_GAME,params:n})}},showInvitationBox:function(e,t){if(this._ensureKongregate()){var n={};e="string"==typeof e?{content:e}:e,n[KonduitEvent.PARAM_INVITATION_MESSAGE]=e.content||"",n[KonduitEvent.PARAM_FRIEND_FILTER]=e.filter||"",n[KonduitEvent.PARAM_KV_PARAMS]=e.kv_params||{},this._enqueueRequest(n,t),this.sendMessage({opcode:KonduitEvent.OP_CHAT_DISPLAY_INVITATION_BOX,params:n})}},showFeedPostBox:function(e,t){if(this._ensureKongregate()){var n={};e="string"==typeof e?{content:e}:e,n[KonduitEvent.PARAM_SHOUT_MESSAGE]=e.content||"",n[KonduitEvent.PARAM_KV_PARAMS]=e.kv_params||{},e.image_uri&&(n[KonduitEvent.PARAM_IMAGE_URI]=e.image_uri),this._enqueueRequest(n,t),this.sendMessage({opcode:KonduitEvent.OP_CHAT_DISPLAY_FEED_POST_BOX,params:n})}},showSignInBox:function(){this.showRegistrationBox()},showRegistrationBox:function(){this._ensureKongregate()&&this.isGuest()&&this.sendMessage({opcode:KonduitEvent.OP_CHAT_DISPLAY_REGISTRATION,params:{}})},showShoutBox:function(e,t){if(this._ensureKongregate()){var n=("string"==typeof e?e:e.content)||"",s={};s[KonduitEvent.PARAM_SHOUT_MESSAGE]=n,this._enqueueRequest(s,t),this.sendMessage({opcode:KonduitEvent.OP_CHAT_DISPLAY_SHOUT_BOX,params:s})}},_ensureKongregate:function(e){return!!this.isKongregate()||(e&&e({success:!1}),!1)},_enqueueRequest:function(e,t){var n=this._nextRequestId();e[KonduitEvent.PARAM_REQUEST_ID]=n,"function"==typeof t&&(this._requestHandlers[n]=t)},_completeRequest:function(e,t){t=t||e;var n=e[KonduitEvent.PARAM_REQUEST_ID],s=this._requestHandlers[n];"function"==typeof s&&(s(t),delete this._requestHandlers[n])},_nextRequestId:function(){return this._requestId+=1,this._requestId}},Kongregate.ChatServices=function(e){this.initialize(e)},Kongregate.ChatServices.DEFAULT_TAB="Default",Kongregate.ChatServices.prototype={initialize:function(e){var t=this;this._services=e.services,this._eventCallbacks=[],this._services.addEventListener(KonduitEvent.KONDUIT_MESSAGE,(function(e){t._onIncomingMessage(e.opcode,e.params)}))},showTab:function(e,t,n){var s={};s[KonduitEvent.PARAM_NAME]=e,s[KonduitEvent.PARAM_DESCRIPTION]=t,n&&n.size&&(s[KonduitEvent.PARAM_CANVAS_SIZE]=n.size),this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_TAB,params:s})},closeTab:function(){this.showTab(Kongregate.ChatServices.DEFAULT_TAB)},displayMessage:function(e,t){var n={};n[KonduitEvent.PARAM_DATA]=e,n[KonduitEvent.PARAM_USER]=t,this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_DISPLAY,params:n})},clearMessages:function(){this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_CLEAR_DIALOG})},displayCanvasImage:function(e,t,n){var s={},i={type:"image",name:e,url:t,position:n};s[KonduitEvent.PARAM_DATA]=i,this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_CANVAS_ELEMENT,params:s})},displayCanvasText:function(e,t,n,s){var i={},a={type:"text",name:e,text:t,position:n,options:s};i[KonduitEvent.PARAM_DATA]=a,this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_CANVAS_ELEMENT,params:i})},drawCanvasObject:function(e,t){var n={},s={type:"draw",name:e,commands:t};n[KonduitEvent.PARAM_DATA]=s,this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_CANVAS_ELEMENT,params:n})},removeCanvasObject:function(e){var t={},n={type:"remove",name:e};t[KonduitEvent.PARAM_DATA]=n,this._services.sendMessage({opcode:KonduitEvent.OP_CHAT_CANVAS_ELEMENT,params:t})},_onIncomingMessage:function(e,t){switch(e){case KonduitEvent.OP_CHAT_MSG:this._handleChatEvent("message",t);break;case KonduitEvent.OP_CHAT_ROOM_MESSAGE:this._handleChatEvent("room.message",t);break;case KonduitEvent.OP_CHAT_TAB:this._handleChatEvent("tab_visible",t)}},addEventListener:function(e,t){"function"==typeof t?(this._eventCallbacks[e]||(this._eventCallbacks[e]=[]),this._eventCallbacks[e].push(t)):Kongregate.Log.error("addEventListener requires a callback function")},_handleChatEvent:function(e,t){var n=this._eventCallbacks[e];if(n)for(var s=0;s<n.length;s++)n[s](t)}},Kongregate.ImageServices=function(e){this.initialize(e)},Kongregate.ImageServices.prototype={initialize:function(e){var t=this;this._services=e.services,this._submitting=!1,this._callback=null,this._services.addEventListener(KonduitEvent.KONDUIT_MESSAGE,(function(e){t._onIncomingMessage(e.opcode,e.params)}))},submitAvatar:function(e,t){if(this._submitting)return Kongregate.Log.warn("Another avatar submission is active, ignoring"),void(t&&t({success:!1}));this._submitting=!0,this._callback=t;var n={image:e};this._services.sendMessage({opcode:KonduitEvent.OP_IMAGE_AVATAR_SUBMIT,params:n})},_onIncomingMessage:function(e,t){KonduitEvent.OP_IMAGE_AVATAR_FINISHED===e&&(this._submitting=!1,this._callback&&this._callback(t.success))}},KongregateAPI.prototype={unityElementId:null,_initialize:function(){if(this._flashVarsString="",this._flashVarsObject={},this._services={},this._postMessageParams=void 0,this._paramsReceived=!1,this._loaded=!1,this._klient=Kongregate.Utils.isKlient(),this._queuedMessages=[],this._loadCallbacks=[],this._processParentKongregateParams(),this._processParams(location.search.split("?")[1]),this._updateDebugLevel(),this._kongWindow=Kongregate.Utils.findKongregateWindow(),this._postMessageParams=!this.flashVarsObject().kongregate_username&&top!=window,this._postMessageParams){var e=this;Kongregate.polyfillJSON(),Kongregate.PostMessage.addMessageListener(window,(function(t){if(e._messageOriginIsKongregate(t)){var n=Kongregate.PostMessage.parseMessage(t.data);n&&"params"===n.type&&e._handleParamsMessage(n.data)}})),this._kongWindow.postMessage("kongregate_request_params","*")}else this._paramsReceived=!0;setTimeout(this._hijackUnityErrorHandler,0)},flashVarsString:function(){return this._flashVarsString},flashVarsObject:function(){return this._flashVarsObject},getVariable:function(e){return this._flashVarsObject[e]},loadAPI:function(e){!this._postMessageParams||this._paramsReceived?this._doLoadAPI(e):this._loadCallbacks.push(e)},getAPI:function(){return this._services},embedFrame:function(e,t){try{console.warn("KONGREGATE WARNING: The Kongregate Shell and embedFrame method are deprecated, and it is very unlikely that this functionality is really needed. See the note on the documentation page: https://docs.kongregate.com/v1.0/docs/concepts-kongregate-shell")}catch(e){}t=t||"contentdiv";var n=document.getElementById(t),s="<iframe id='content' frameborder='0' ";s+="style='position:relative;top:0px;left:0px;",s+="border:0px none;padding:0px;width:"+n.offsetWidth+"px;height:"+n.offsetHeight+"px;'",s+="src='"+e+"'></iframe>",n.innerHTML=s},_forwardToKlient:function(e,t){this._klient&&(t="kongregate:api-message:"+t,top.postMessage({type:t,message:e},"*"))},_setGameSwf:function(e){var t=this.flashVarsObject(),n=this,s=this._findSwf(e);s?(this._gameSwf=s,this.messageConnection=this.messageConnection||this._createMessageConnection(t),this.messageConnection.isSupported()?setTimeout((function(){n._gameSwf.setConnectionObject("kongregateAPI.messageConnection")?n.messageConnection.connect():Kongregate.Log.warn("setConnectionObject returned false, not connecting")}),1):(Kongregate.Log.debug("MessageConnection isSupported was false"),setTimeout((function(){n._gameSwf.setConnectionObject(null)}),1))):Kongregate.Log.debug("Kongregate game SWF element does not appear to be a swf: "+e)},_isSwf:function(e){return e&&void 0!==e.Play&&void 0!==e.setConnectionObject},_findSwf:function(e){var t=document.getElementById(e),n=this,s=function(e){for(var s=0;s<e.length;s++)if(t=e[s],n._isSwf(t))return t};return this._isSwf(t)?t:t=s(document.getElementsByName(e))||s(document.querySelectorAll("[id='"+e+"']"))||s(document.getElementsByTagName("object"))||s(document.getElementsByTagName("embed"))},_updateDebugLevel:function(){Kongregate.Log.debugLevel=this._flashVarsObject.kongregate_debug_level||2},_processParentKongregateParams:function(){try{for(var e=window.parent;e!==top;){try{e.kongregateAPI&&this._processParams(e.kongregateAPI.flashVarsString())}catch(e){}e=e.parent}}catch(e){}},_handleParamsMessage:function(e){if(!this._paramsReceived){for(var t in e)this._processParam(t,e[t]);this._paramsReceived=!0,this._updateDebugLevel(),this._hijackUnityErrorHandler(),this._loadCallbacks.length>0&&this._doLoadAPI()}},_fireLoadCallbacks:function(){var e=this._loadCallbacks.length;Kongregate.Log.debug("Kongregate API: Firing "+e+" load callback(s)");for(var t=0;t<e;t++){var n=this._loadCallbacks[t];"function"==typeof n&&setTimeout(n,0)}this._loadCallbacks=[]},_checkAlreadyLoaded:function(){return this._loaded&&this._fireLoadCallbacks(),this._loaded},_doLoadAPI:function(e){var t=this;Kongregate.contentLoaded((function(){t._loadCallbacks.push(e),t._checkAlreadyLoaded()||(t._loaded=!0,Kongregate.polyfillJSON(),t._hijackUnityErrorHandler(),t.messageConnection=t._createMessageConnection(),t._createJavascriptApi(),t._fireLoadCallbacks())}))},_processParams:function(e){if(e)for(var t=e.split("&"),n=0;n<t.length;n++){var s=t[n].split("=");if(s&&2==s.length){var i=s[0],a=s[1];this._processParam(i,a)}}},_processParam:function(e,t){0===e.indexOf("kongregate")&&(this._flashVarsObject[e]=t,this._flashVarsString+=e+"="+t+"&")},_messageOriginIsKongregate:function(e){var t=decodeURIComponent(this._flashVarsObject.kongregate_host||""),n=e.origin;return t&&(n===t||n=="http://"+t||n=="https://"+t)},_createJavascriptApi:function(){var e=this;this._services.services=new Kongregate.ApiServices({kongregate_variables:this.flashVarsObject(),message_connection:this.messageConnection}),this._services.stats=new Kongregate.StatisticServices({services:this._services.services}),this._services.sharedContent=new Kongregate.SharedContentServices({services:this._services.services}),this._services.images=new Kongregate.ImageServices({services:this._services.services}),this._services.mtx=new Kongregate.MicrotransactionServices({services:this._services.services}),this._services.chat=new Kongregate.ChatServices({services:this._services.services}),this._services.analytics=new Kongregate.AnalyticsServices({services:this._services.services,mtx:this._services.mtx,kongregate_variables:this.flashVarsObject(),enable_persistence:!0,start:!0}),setTimeout((function(){e.messageConnection.connect()}),0)},_createMessageConnection:function(){var e=this,t=this.flashVarsObject(),n={target_window:this._kongWindow,target_origin:decodeURIComponent(t.kongregate_host),channel_id:t.kongregate_channel_id,retry_connection:!0};this._klient&&(n.send_listener=function(t,n){e._forwardToKlient({opcode:t,params:n},"out")});var s=new Kongregate.MessageConnection(n);return s.isSupported()&&s.addMessageListener((function(t,n){var s=e._gameSwf,i={opcode:t,params:n};s&&"function"==typeof s.handleMessageConnectionEvent&&s.handleMessageConnectionEvent(JSON.stringify(i))})),s},_hijackUnityErrorHandler:function(){try{kongregateUnitySupport.hijackUnityErrorHandler()}catch(e){}}},kongregateAPI=new KongregateAPI,function(e){function t(e){for(var t="",n="",s=0,i=0,a=0,r=e.length;a<r;a++){var o=e.charCodeAt(a);o<128?i++:(n=o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),i>s&&(t+=e.slice(s,i)),t+=n,s=i=a+1)}return i>s&&(t+=e.slice(s,r)),t}function n(e){var t,n;if(E=!1,f=p=(e+="").length,p>63){for(s(e.substring(0,64)),r(u),E=!0,t=128;t<=p;t+=64)s(e.substring(t-64,t)),o(u);e=e.substring(t-64),p=e.length}for(g[0]=g[1]=g[2]=g[3]=g[4]=g[5]=g[6]=g[7]=g[8]=g[9]=g[10]=g[11]=g[12]=g[13]=g[14]=g[15]=0,t=0;t<p;t++)0===(n=3&t)?g[t>>2]=e.charCodeAt(t):g[t>>2]|=e.charCodeAt(t)<<l[n];if(g[t>>2]|=h[3&t],t>55)return E?o(g):(r(g),E=!0),o([0,0,0,0,0,0,0,0,0,0,0,0,0,0,f<<3,0]);g[14]=f<<3,E?o(g):r(g)}function s(e){for(var t=16;t--;){var n=t<<2;u[t]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24)}}function i(e,s,i){n(s?e:t(e));var a=v[0];return c[1]=d[15&a],c[0]=d[15&(a>>=4)],c[3]=d[15&(a>>=4)],c[2]=d[15&(a>>=4)],c[5]=d[15&(a>>=4)],c[4]=d[15&(a>>=4)],c[7]=d[15&(a>>=4)],c[6]=d[15&(a>>=4)],a=v[1],c[9]=d[15&a],c[8]=d[15&(a>>=4)],c[11]=d[15&(a>>=4)],c[10]=d[15&(a>>=4)],c[13]=d[15&(a>>=4)],c[12]=d[15&(a>>=4)],c[15]=d[15&(a>>=4)],c[14]=d[15&(a>>=4)],a=v[2],c[17]=d[15&a],c[16]=d[15&(a>>=4)],c[19]=d[15&(a>>=4)],c[18]=d[15&(a>>=4)],c[21]=d[15&(a>>=4)],c[20]=d[15&(a>>=4)],c[23]=d[15&(a>>=4)],c[22]=d[15&(a>>=4)],a=v[3],c[25]=d[15&a],c[24]=d[15&(a>>=4)],c[27]=d[15&(a>>=4)],c[26]=d[15&(a>>=4)],c[29]=d[15&(a>>=4)],c[28]=d[15&(a>>=4)],c[31]=d[15&(a>>=4)],c[30]=d[15&(a>>=4)],i?c:c.join("")}function a(e,t,n,s,i,a,r){return((t+=e+s+r)<<i|t>>>a)+n<<0}function r(e){_(0,0,0,0,e),v[0]=m[0]+1732584193<<0,v[1]=m[1]-271733879<<0,v[2]=m[2]-1732584194<<0,v[3]=m[3]+271733878<<0}function o(e){_(v[0],v[1],v[2],v[3],e),v[0]=m[0]+v[0]<<0,v[1]=m[1]+v[1]<<0,v[2]=m[2]+v[2]<<0,v[3]=m[3]+v[3]<<0}function _(e,t,n,s,i){var r,o;E?(e=a((n^s)&t^s,e,t,i[0],7,25,-680876936),s=a((t^n)&e^n,s,e,i[1],12,20,-389564586),n=a((e^t)&s^t,n,s,i[2],17,15,606105819),t=a((s^e)&n^e,t,n,i[3],22,10,-1044525330)):(e=((e=i[0]-680876937)<<7|e>>>25)-271733879<<0,s=((s=i[1]-117830708+(2004318071&e^-1732584194))<<12|s>>>20)+e<<0,n=((n=i[2]-1126478375+((-271733879^e)&s^-271733879))<<17|n>>>15)+s<<0,t=((t=i[3]-1316259209+((s^e)&n^e))<<22|t>>>10)+n<<0),e=a((n^s)&t^s,e,t,i[4],7,25,-176418897),s=a((t^n)&e^n,s,e,i[5],12,20,1200080426),n=a((e^t)&s^t,n,s,i[6],17,15,-1473231341),t=a((s^e)&n^e,t,n,i[7],22,10,-45705983),e=a((n^s)&t^s,e,t,i[8],7,25,1770035416),s=a((t^n)&e^n,s,e,i[9],12,20,-1958414417),n=a((e^t)&s^t,n,s,i[10],17,15,-42063),t=a((s^e)&n^e,t,n,i[11],22,10,-1990404162),e=a((n^s)&t^s,e,t,i[12],7,25,1804603682),s=a((t^n)&e^n,s,e,i[13],12,20,-40341101),n=a((e^t)&s^t,n,s,i[14],17,15,-1502002290),t=a((s^e)&n^e,t,n,i[15],22,10,1236535329),e=a((t^n)&s^n,e,t,i[1],5,27,-165796510),s=a((e^t)&n^t,s,e,i[6],9,23,-1069501632),n=a((s^e)&t^e,n,s,i[11],14,18,643717713),t=a((n^s)&e^s,t,n,i[0],20,12,-373897302),e=a((t^n)&s^n,e,t,i[5],5,27,-701558691),s=a((e^t)&n^t,s,e,i[10],9,23,38016083),n=a((s^e)&t^e,n,s,i[15],14,18,-660478335),t=a((n^s)&e^s,t,n,i[4],20,12,-405537848),e=a((t^n)&s^n,e,t,i[9],5,27,568446438),s=a((e^t)&n^t,s,e,i[14],9,23,-1019803690),n=a((s^e)&t^e,n,s,i[3],14,18,-187363961),t=a((n^s)&e^s,t,n,i[8],20,12,1163531501),e=a((t^n)&s^n,e,t,i[13],5,27,-1444681467),s=a((e^t)&n^t,s,e,i[2],9,23,-51403784),n=a((s^e)&t^e,n,s,i[7],14,18,1735328473),t=a((n^s)&e^s,t,n,i[12],20,12,-1926607734),e=a((r=t^n)^s,e,t,i[5],4,28,-378558),s=a(r^e,s,e,i[8],11,21,-2022574463),n=a((o=s^e)^t,n,s,i[11],16,16,1839030562),t=a(o^n,t,n,i[14],23,9,-35309556),e=a((r=t^n)^s,e,t,i[1],4,28,-1530992060),s=a(r^e,s,e,i[4],11,21,1272893353),n=a((o=s^e)^t,n,s,i[7],16,16,-155497632),t=a(o^n,t,n,i[10],23,9,-1094730640),e=a((r=t^n)^s,e,t,i[13],4,28,681279174),s=a(r^e,s,e,i[0],11,21,-358537222),n=a((o=s^e)^t,n,s,i[3],16,16,-722521979),t=a(o^n,t,n,i[6],23,9,76029189),e=a((r=t^n)^s,e,t,i[9],4,28,-640364487),s=a(r^e,s,e,i[12],11,21,-421815835),n=a((o=s^e)^t,n,s,i[15],16,16,530742520),t=a(o^n,t,n,i[2],23,9,-995338651),e=a(n^(t|~s),e,t,i[0],6,26,-198630844),s=a(t^(e|~n),s,e,i[7],10,22,1126891415),n=a(e^(s|~t),n,s,i[14],15,17,-1416354905),t=a(s^(n|~e),t,n,i[5],21,11,-57434055),e=a(n^(t|~s),e,t,i[12],6,26,1700485571),s=a(t^(e|~n),s,e,i[3],10,22,-1894986606),n=a(e^(s|~t),n,s,i[10],15,17,-1051523),t=a(s^(n|~e),t,n,i[1],21,11,-2054922799),e=a(n^(t|~s),e,t,i[8],6,26,1873313359),s=a(t^(e|~n),s,e,i[15],10,22,-30611744),n=a(e^(s|~t),n,s,i[6],15,17,-1560198380),t=a(s^(n|~e),t,n,i[13],21,11,1309151649),e=a(n^(t|~s),e,t,i[4],6,26,-145523070),s=a(t^(e|~n),s,e,i[11],10,22,-1120210379),n=a(e^(s|~t),n,s,i[2],15,17,718787259),t=a(s^(n|~e),t,n,i[9],21,11,-343485551),m[0]=e,m[1]=t,m[2]=n,m[3]=s}var c=[],g=[],u=[],h=[],d="0123456789abcdef".split(""),l=[],v=[],E=!1,f=0,p=0,m=[];if(e.Int32Array)g=new Int32Array(16),u=new Int32Array(16),h=new Int32Array(4),l=new Int32Array(4),v=new Int32Array(4),m=new Int32Array(4);else{var A;for(A=0;A<16;A++)g[A]=u[A]=0;for(A=0;A<4;A++)h[A]=l[A]=v[A]=m[A]=0}h[0]=128,h[1]=32768,h[2]=8388608,h[3]=-2147483648,l[0]=0,l[1]=8,l[2]=16,l[3]=24,Kongregate.Utils.md5=i}("undefined"==typeof global?window:global),Kongregate.MicrotransactionServices=function(e){this.initialize(e)},Kongregate.MicrotransactionServices.prototype={initialize:function(e){var t=this;this._services=e.services,this._services.addEventListener(KonduitEvent.KONDUIT_MESSAGE,(function(e){t._onIncomingMessage(e.opcode,e.params)})),this._adCallbacks=[]},requestItemList:function(e,t){Kongregate.Log.info("MicrotransactionServices.requestItemList("+e+")");var n={};e&&e.length>0&&(n[KonduitEvent.PARAM_ITEM_TAGS]=e),this._services._enqueueRequest(n,t),this._services.sendMessage({opcode:KonduitEvent.ITEM_LIST,params:n})},requestUserItemList:function(e,t){Kongregate.Log.info("MicrotransactionServices.requestUserItemList("+e+")");var n={};n[KonduitEvent.PARAM_USER]=e||this._services.getUsername(),this._services._enqueueRequest(n,t),this._services.sendMessage({opcode:KonduitEvent.ITEM_INSTANCES,params:n})},purchaseItems:function(e,t){Kongregate.Log.info("MicrotransactionServices.purchaseItems("+e+")");var n={};e&&e.length>0?(this._purchaseItemsCallback=t,n[KonduitEvent.PARAM_ITEMS]=e,this._services.sendMessage({opcode:KonduitEvent.ITEM_CHECKOUT,params:n})):(Kongregate.Log.error("purchaseItems requires a non-empty item identifier array"),t&&t({success:!1}))},purchaseItemsRemote:function(e,t){Kongregate.Log.info("MicrotransactionServices.purchaseItemsRemote("+e+")");var n={};e&&String(e).length>0?(this._purchaseItemsCallback=t,n[KonduitEvent.PARAM_ORDER_INFO]=String(e),this._services.sendMessage({opcode:KonduitEvent.ITEM_CHECKOUT,params:n})):(Kongregate.Log.error("purchaseItemsRemote requires an orderInformation string"),t&&t({success:!1}))},useItemInstance:function(e,t){Kongregate.Log.info("MicrotransactionServices.useItemInstance("+e+")");var n={};e?(n[KonduitEvent.PARAM_ID]=e,this._services._enqueueRequest(n,t),this._services.sendMessage({opcode:KonduitEvent.USE_ITEM_INSTANCE,params:n})):(Kongregate.Log.error("useItemInstance requires an itemInstanceId"),t&&t({success:!1}))},showKredPurchaseDialog:function(e){var t={};t[KonduitEvent.PARAM_PURCHASE_METHOD]=e,this._services.sendMessage({opcode:KonduitEvent.PURCHASE_KREDS,params:t})},initializeIncentivizedAds:function(){this._services.sendMessage({opcode:KonduitEvent.ADS_INITIALIZE})},showIncentivizedAd:function(){this._services.sendMessage({opcode:KonduitEvent.ADS_SHOW_INCENTIVIZED})},addEventListener:function(e,t){"function"==typeof t?(this._adCallbacks[e]||(this._adCallbacks[e]=[]),this._adCallbacks[e].push(t)):Kongregate.Log.error("addEventListener requires a callback function")},_onIncomingMessage:function(e,t){switch(e){case KonduitEvent.ITEM_INSTANCES:case KonduitEvent.ITEM_LIST:case KonduitEvent.USE_ITEM_INSTANCE:this._services._completeRequest(t);break;case KonduitEvent.PURCHASE_RESULT:this._onPurchaseResultResponse(t);break;case KonduitEvent.ADS_AVAILABLE:this._handleAdEvent("adsAvailable",t);break;case KonduitEvent.ADS_UNAVAILABLE:this._handleAdEvent("adsUnavailable",t);break;case KonduitEvent.AD_OPENED:this._handleAdEvent("adOpened",t);break;case KonduitEvent.AD_COMPLETED:this._handleAdEvent("adCompleted",t);break;case KonduitEvent.AD_ABANDONED:this._handleAdEvent("adAbandoned",t)}},_onPurchaseResultResponse:function(e){this._purchaseItemsCallback&&(this._purchaseItemsCallback(e),this._purchaseItemsCallback=null)},_handleAdEvent:function(e,t){var n=this._adCallbacks[e];if(n)for(var s=0;s<n.length;s++)n[s](t)}},Kongregate.SharedContentServices=function(e){this.initialize(e)},Kongregate.SharedContentServices.CONTENT_TYPE_LIMIT=12,Kongregate.SharedContentServices.prototype={initialize:function(e){var t=this;this._services=e.services,this._loadListeners={},this._services.addEventListener(KonduitEvent.KONDUIT_MESSAGE,(function(e){t._onIncomingMessage(e.opcode,e.params)}))},browse:function(e,t,n){var s={};s[KonduitEvent.PARAM_CONTENT_TYPE]=e,n&&(s[KonduitEvent.PARAM_LABEL]=n),t&&(s[KonduitEvent.PARAM_SORT]=t),this._services.sendMessage({opcode:KonduitEvent.OP_BROWSE_SHARED_CONTENT,params:s})},save:function(e,t,n,s,i){if(this._saving||e.length>Kongregate.SharedContentServices.CONTENT_TYPE_LIMIT)n&&n({success:!1});else{var a={};a[KonduitEvent.PARAM_CONTENT_TYPE]=e,a[KonduitEvent.PARAM_LABEL]=i,a[KonduitEvent.PARAM_DATA]=t,a[KonduitEvent.PARAM_IMAGE]=s,this._services.sendMessage({opcode:KonduitEvent.OP_SAVE_SHARED_CONTENT,params:a}),this._saving=!0,this._saveCallback=n}},addLoadListener:function(e,t){this._loadListeners[e]||(this._loadListeners[e]=[]),this._loadListeners[e].push(t)},_onIncomingMessage:function(e,t){switch(e){case KonduitEvent.OP_SHARED_CONTENT_SAVE_COMPLETE:this._onSaveContentComplete(t);break;case KonduitEvent.OP_LOAD_SHARED_CONTENT:this._onLoadSharedContent(t)}},_onSaveContentComplete:function(e){if(this._saving=!1,this._saveCallback){var t={id:e[KonduitEvent.PARAM_ID],success:e[KonduitEvent.PARAM_SUCCESS],name:e[KonduitEvent.PARAM_NAME],permalink:e[KonduitEvent.PARAM_PERMALINK],content:e[KonduitEvent.PARAM_DATA],label:e[KonduitEvent.PARAM_LABEL]};this._saveCallback(t),this._saveCallback=null}},_onLoadSharedContent:function(e){var t=e[KonduitEvent.PARAM_CONTENT_TYPE],n={id:e[KonduitEvent.PARAM_ID],name:e[KonduitEvent.PARAM_NAME],permalink:e[KonduitEvent.PARAM_PERMALINK],content:e[KonduitEvent.PARAM_DATA],label:e[KonduitEvent.PARAM_LABEL]};Kongregate.Log.info({loadContent:n});for(var s=this._loadListeners[t]||[],i=0;i<s.length;i++)s[i](n)}},Kongregate.StatisticServices=function(e){this.initialize(e)},Kongregate.StatisticServices.prototype={initialize:function(e){this._services=e.services},submit:function(e,t){Kongregate.Log.info("StatServices.submit("+e+","+t+")"),e&&null!=t&&!isNaN(t)?this._services.sendMessage({opcode:KonduitEvent.OP_STATS_SUBMIT,params:{stats:[{name:e,value:t}]}}):Kongregate.Log.warn("Invalid stat name or value:",e,t)},submitArray:function(e){if(e&&e.length)for(var t=0;t<e.length;t++)this.submit(e[t].name,e[t].value)}},"undefined"==typeof kongregateUnitySupport&&(kongregateUnitySupport=function(){function e(e){var t,n=g.getElementById(e);if(!n)return null;if(E.win&&E.ie){var s=n.getElementsByTagName("object")[0];s&&"OBJECT"==s.nodeName&&(t=s)}else{var i=n.getElementsByTagName("embed")[0]
;i&&"EMBED"==i.nodeName&&(t=i)}return t&&typeof t.GetPluginVersion==_?null:t}function t(){return typeof kongregateAPI!=_&&kongregateAPI.unityGameInstance?kongregateAPI.unityGameInstance:"function"==typeof window.SendMessage?window:window.gameInstance&&"function"==typeof window.gameInstance.SendMessage?window.gameInstance:window.unityInstance&&"function"==typeof window.unityInstance.SendMessage?window.unityInstance:null}function n(){var n=t();if(n)return n;var s="kongregateUnityDiv";return typeof kongregateAPI!=_&&kongregateAPI.unityElementId&&(s=kongregateAPI.unityElementId),e(s)||e("unityPlayer")}function s(){return[kongregate.services.getUserId(),kongregate.services.getUsername(),kongregate.services.getGameAuthToken()].join("|")}function i(){for(var e=0;e<o.length;e++){var t=o[e];n().SendMessage(t.object,t.callback,s())}o=[]}function a(e){if("string"==typeof e)return-1!==e.indexOf("Cannot enlarge memory arrays")?"UnityWebGL:Memory:WebGL":-1!==e.indexOf("out of memory")?"UnityWebGL:Memory:Browser":void 0}function r(e){try{var t=a(e);if(!t||v[t])return;var n=decodeURIComponent(kongregateAPI.flashVarsObject().kongregate_host||"*");v[t]=!0,top.postMessage({kongregateGameError:{type:t}},n)}catch(e){}}var o=[],_="undefined",c=navigator,g=(window,document),u=c.userAgent,h=c.platform,d=!1,l=/chrome/i.test(u),v={};/msie/i.test(u)?d=parseFloat(u.replace(/^.*msie ([0-9]+(\.[0-9]+)?).*$/i,"$1")):/Trident/i.test(u)&&(d=parseFloat(u.replace(/^.*rv:([0-9]+(\.[0-9]+)?).*$/i,"$1")));var E={w3:typeof g.getElementById!=_&&typeof g.getElementsByTagName!=_&&typeof g.createElement!=_,win:h?/win/i.test(h):/win/i.test(u),mac:h?/mac/i.test(h):/mac/i.test(u),ie:d,ff:/firefox/i.test(u),op:/opera/i.test(u),ch:l,ch_v:!!/chrome/i.test(u)&&parseFloat(u.replace(/^.*chrome\/(\d+(\.\d+)?).*$/i,"$1")),sf:/safari/i.test(u)&&!l,wk:!!/webkit/i.test(u)&&parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/i,"$1")),x64:/win64/i.test(u)&&/x64/i.test(u),moz:/mozilla/i.test(u)?parseFloat(u.replace(/^.*mozilla\/([0-9]+(\.[0-9]+)?).*$/i,"$1")):0,mobile:/ipad/i.test(h)||/iphone/i.test(h)||/ipod/i.test(h)||/android/i.test(u)||/windows phone/i.test(u)};return E.clientBrand=E.ch?"ch":E.ff?"ff":E.sf?"sf":E.ie?"ie":E.op?"op":"??",E.clientPlatform=E.win?"win":E.mac?"mac":"???",{onUnityEmbed:function(e){$("unity_missing")&&(e.success?"missingUnityObject"==e.id?($("missingUnityObject").update(""),$("kongregateUnityDiv").update(""),top.location.replace(decodeURIComponent(kongregateAPI.getVariable("kongregate_game_url")))):$("unity_missing").remove():$("unity_missing").show())},initAPI:function(e,t){e=e||"KongregateAPI",t=t||"OnKongregateAPILoaded",o.push({object:e,callback:t}),kongregateAPI.loadAPI((function(){"undefined"==typeof kongregate&&(kongregate=kongregateAPI.getAPI()),i()}))},getUnityObject:function(){return n()},getUserInfoString:function(){return s()},hijackUnityErrorHandler:function(){if(!kongregateAPI.disableUnityErrorHandler&&!this.unityErrorHandlerInstalled){var e=function(e){if(e.match(/Permission denied to access property/)){try{console.error("Caught error: "+e)}catch(e){}return!0}r(e)};if("undefined"!=typeof UnityLoader&&UnityLoader.Error&&UnityLoader.Error.handler){var t=UnityLoader.Error.handler;UnityLoader.Error.handler=function(n){return!!e(n.message)||"function"==typeof t&&t.apply(UnityLoader.Error,arguments)},this.unityErrorHandlerInstalled=!0}var n=window.Module;if(n&&n.TOTAL_MEMORY&&n.codeUrl){var s=n.errorhandler;n.errorhandler=function(t,n,i){return!!e(t)||"function"==typeof s&&s(t,n,i)},this.unityErrorHandlerInstalled=!0}}}}}());